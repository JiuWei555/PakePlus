import{d as e,r as a,c as t,a as l,b as o,s as n,v as s,t as r,h as u}from"./index-hcCBxXbc.js";import{_ as i}from"./_plugin-vue_export-helper-BCo6x5W8.js";const c={class:"tts-container"},p={class:"input-group"},d={class:"input-group"},v={class:"input-group"},h={class:"input-group"},f=["disabled"],_={key:0,class:"error-message"},y={key:1,class:"audio-container"},m=["src"],b=["href"],g=i(e({__name:"ceshi",setup(e){const i=a(""),g=a(""),w=a(""),A=a("这是一段测试文本，用于测试字节大模型语音合成http单向流式接口效果。"),x=a(null),U=a(!1),k=a(null),I=e=>{const a=atob(e),t=a.length,l=new Uint8Array(t);for(let o=0;o<t;o++)l[o]=a.charCodeAt(o);return l.buffer},R=async()=>{x.value=null,k.value=null,U.value=!0;try{if(!(i.value&&g.value&&w.value&&A.value))throw new Error("请填写所有必填参数");const a={"X-Api-App-Id":i.value,"X-Api-Access-Key":g.value,"X-Api-Resource-Id":w.value,"X-Api-App-Key":"aGjiRDfUWi","Content-Type":"application/json",Connection:"keep-alive"},t={disable_markdown_filter:!0,enable_language_detector:!0,enable_latex_tn:!0,disable_default_bit_rate:!0,max_length_to_filter_parenthesis:0,cache_config:{text_type:1,use_cache:!0}},l={user:{uid:"12345"},req_params:{text:A.value,speaker:"zh_female_wanqudashu_moon_bigtts",additions:JSON.stringify(t),audio_params:{format:"mp3",sample_rate:24e3}}},o=await fetch("https://openspeech.bytedance.com/api/v3/tts/unidirectional",{method:"POST",headers:a,body:JSON.stringify(l)});if(!o.body)throw new Error("无法读取响应流");const n=o.body.getReader(),s=new TextDecoder;let r=[],u="",c=0;for(;;){const{done:a,value:t}=await n.read();if(a)break;u+=s.decode(t,{stream:!0});const l=u.split(/\r\n|\n|\r/);u=l.pop()||"";for(const o of l)if(o.trim())try{const e=JSON.parse(o);if(2e7===e.code)break;if(0===e.code&&e.data){const a=I(e.data);r.push(new Uint8Array(a)),c+=a.byteLength}else if(e.code>0)throw new Error(`接口返回错误: ${JSON.stringify(e)}`)}catch(e){}}if(!(r.length>0))throw new Error("未接收到音频数据");{const e=new Uint8Array(c);let a=0;for(const l of r)e.set(l,a),a+=l.length;const t=new Blob([e],{type:"audio/mp3"});x.value=URL.createObjectURL(t)}}catch(a){k.value=a.message||"语音合成失败"}finally{U.value=!1}};return(e,a)=>(u(),t("div",c,[a[8]||(a[8]=l("h1",null,"字节大模型语音合成",-1)),l("div",p,[a[4]||(a[4]=l("label",null,"App ID:",-1)),n(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),type:"text",placeholder:"请输入 App ID"},null,512),[[s,i.value]])]),l("div",d,[a[5]||(a[5]=l("label",null,"Access Key:",-1)),n(l("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),type:"text",placeholder:"请输入 Access Key"},null,512),[[s,g.value]])]),l("div",v,[a[6]||(a[6]=l("label",null,"Resource ID:",-1)),n(l("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>w.value=e),type:"text",placeholder:"请输入 Resource ID"},null,512),[[s,w.value]])]),l("div",h,[a[7]||(a[7]=l("label",null,"合成文本:",-1)),n(l("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>A.value=e),rows:"4",placeholder:"请输入要合成的文本"},null,512),[[s,A.value]])]),l("button",{onClick:R,disabled:U.value},r(U.value?"合成中...":"开始语音合成"),9,f),k.value?(u(),t("div",_,r(k.value),1)):o("",!0),x.value?(u(),t("div",y,[l("audio",{controls:"",src:x.value},null,8,m),l("a",{href:x.value,download:"tts_output.mp3",class:"download-link"},"下载音频",8,b)])):o("",!0)]))}}),[["__scopeId","data-v-642e0540"]]);export{g as default};
